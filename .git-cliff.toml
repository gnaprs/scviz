# .git-cliff.toml
# Clean changelog configuration

[changelog]
header = """
All notable changes to this project are documented here.
"""

body = """
{% if releases is defined and releases | length > 0 %}
{# --- Multi-release mode (e.g. -a) --- #}
{% for release in releases %}
<details{% if loop.first %} open{% endif %}>
<summary><b>{{ release.version | trim_start_matches(pat="v") }}</b>{% if release.timestamp %} – {{ release.timestamp | date(format="%Y-%m-%d") }}{% endif %}</summary>

{% for group, commits in release.commits | group_by(attribute="group") %}
#### {{ group | upper_first }}
{% for commit in commits %}
{% set msg = commit.message | split(pat="\n") | first | trim %}
{% if msg matches "^[a-z]+\\(.+\\):" %}
- ({{ msg | regex_replace(pattern="^[a-z]+\\((.+)\\):.*", replace="\\1") }}) {{ msg | regex_replace(pattern="^[a-z]+\\(.+\\):\\s*", replace="") | upper_first }} ({{ commit.id | truncate(length=7) }})
{% else %}
- {{ msg | upper_first }} ({{ commit.id | truncate(length=7) }})
{% endif %}
{% endfor %}
{% endfor %}

</details>
{% endfor %}
{% else %}
{# --- Single-release modes (e.g. --latest, --current, --unreleased) --- #}
<details open>
<summary><b>{{ version | default(value="Unreleased") | trim_start_matches(pat="v") }}</b>{% if timestamp %} – {{ timestamp | date(format="%Y-%m-%d") }}{% endif %}</summary>

{% for group, commits in commits | group_by(attribute="group") %}
#### {{ group | upper_first }}
{% for commit in commits %}
{% set msg = commit.message | split(pat="\n") | first | trim %}
{% if msg matches "^[a-z]+\\(.+\\):" %}
- ({{ msg | regex_replace(pattern="^[a-z]+\\((.+)\\):.*", replace="\\1") }}) {{ msg | regex_replace(pattern="^[a-z]+\\(.+\\):\\s*", replace="") | upper_first }} ({{ commit.id | truncate(length=7) }})
{% else %}
- {{ msg | upper_first }} ({{ commit.id | truncate(length=7) }})
{% endif %}
{% endfor %}
{% endfor %}

</details>
{% endif %}
"""


footer = """
<!-- generated by git-cliff -->
"""
trim = true

[git]
tag_pattern = "v[0-9]*"
conventional_commits = true
filter_unconventional = false
filter_commits = false
sort_commits = "oldest"
topo_order = false

commit_parsers = [
  # skip noise
  { message = "(?i)merge (pull request|branch|development)", skip = true },
  { message = "(?i)update to v[0-9]", skip = true },

  # Conventional Commit types
  { message = "^(feat)(\\(.+\\))?:", group = "Added" },
  { message = "^(fix)(\\(.+\\))?:", group = "Fixed" },
  { message = "^(refactor)(\\(.+\\))?:", group = "Changed" },
  { message = "^(perf)(\\(.+\\))?:", group = "Performance" },
  { message = "^(style)(\\(.+\\))?:", group = "Style" },
  { message = "^(build)(\\(.+\\))?:", group = "Build System" },
  { message = "^(ci)(\\(.+\\))?:", group = "CI" },
  { message = "^(test)(\\(.+\\))?:", group = "Tests" },
  { message = "^(chore)(\\(.+\\))?:", group = "Chores" },
  { message = "^(docs)(\\(.+\\))?:", group = "Documentation" },

  # Legacy keyword groups (for older commits)
  { message = "(?i)^(add|added|implement|introduce|create|upload)", group = "Added" },
  { message = "(?i)^(fix|bug|bugfix|resolve|patch)", group = "Fixed" },
  { message = "(?i)^(update|change|modify|adjust|tweak|improve|enhance|overhaul|rewrite|refactor|edit|editing)", group = "Changed" },
  { message = "(?i)^(test|pytest|unit)", group = "Tests" },
  { message = "(?i)^(doc|readme|mkdocs|comment)", group = "Documentation" },
  { message = "(?i)^(ci|workflow|action|github|auto)", group = "CI" },

  # fallback
  { message = ".*", group = "Other" }
]
