# .git-cliff.toml
# Clean changelog configuration

[changelog]
header = """
All notable changes to this project are documented here.
"""

body = """
{% if releases is defined and releases | length > 0 %}
{% for release in releases %}
<details{% if loop.first %} open{% endif %}>
<summary><b>{{ release.version | trim_start_matches(pat="v") }}</b>{% if release.timestamp %} – {{ release.timestamp | date(format="%Y-%m-%d") }}{% endif %}</summary>

{% for group, commits in release.commits | group_by(attribute="group") %}
#### {{ group | upper_first }}
{% for scope, commits in commits | group_by(attribute="scope") %}
{% if scope != "unscoped" %}
##### ({{ scope | upper_first }})
{% endif %}
{% for commit in commits %}
- {{ commit.message | upper_first }} ({{ commit.id | truncate(length=7) }})
{% endfor %}
{% endfor %}
{% endfor %}

</details>
{% endfor %}
{% else %}
<details open>
<summary><b>{{ version | default(value="Unreleased") | trim_start_matches(pat="v") }}</b>{% if timestamp %} – {{ timestamp | date(format="%Y-%m-%d") }}{% endif %}</summary>

{% for group, commits in commits | group_by(attribute="group") %}
#### {{ group | upper_first }}
{% for scope, commits in commits | group_by(attribute="scope") %}
{% if scope != "unscoped" %}
##### ({{ scope | upper_first }})
{% endif %}
{% for commit in commits %}
- {{ commit.message | upper_first }} ({{ commit.id | truncate(length=7) }})
{% endfor %}
{% endfor %}
{% endfor %}

</details>
{% endif %}
"""


footer = """
<!-- generated by git-cliff -->
"""
trim = true

[git]
tag_pattern = "v[0-9]*"
conventional_commits = true
filter_unconventional = false
filter_commits = false
sort_commits = "oldest"
topo_order = false

commit_parsers = [
  # skip noise
  { message = "(?i)merge (pull request|branch|development)", skip = true },
  { message = "(?i)update to v[0-9]", skip = true },

  # Conventional Commit types (with scopes)
  { message = "^(feat)(\\(.+\\))?:", group = "Added", default_scope = "unscoped" },
  { message = "^(fix)(\\(.+\\))?:", group = "Fixed", default_scope = "unscoped" },
  { message = "^(refactor)(\\(.+\\))?:", group = "Changed", default_scope = "unscoped" },
  { message = "^(perf)(\\(.+\\))?:", group = "Performance", default_scope = "unscoped" },
  { message = "^(style)(\\(.+\\))?:", group = "Style", default_scope = "unscoped" },
  { message = "^(build)(\\(.+\\))?:", group = "Build System", default_scope = "unscoped" },
  { message = "^(ci)(\\(.+\\))?:", group = "CI", default_scope = "unscoped" },
  { message = "^(test)(\\(.+\\))?:", group = "Tests", default_scope = "unscoped" },
  { message = "^(chore)(\\(.+\\))?:", group = "Chores", default_scope = "unscoped" },
  { message = "^(docs)(\\(.+\\))?:", group = "Documentation", default_scope = "unscoped" },

  # Legacy keyword groups (for older commits)
  { message = "(?i)^(add|added|implement|introduce|create|upload)", group = "Added" },
  { message = "(?i)^(fix|bug|bugfix|resolve|patch)", group = "Fixed" },
  { message = "(?i)^(update|change|modify|adjust|tweak|improve|enhance|overhaul|rewrite|refactor|edit|editing)", group = "Changed" },
  { message = "(?i)^(test|pytest|unit)", group = "Tests" },
  { message = "(?i)^(doc|readme|mkdocs|comment)", group = "Documentation" },
  { message = "(?i)^(ci|workflow|action|github|auto)", group = "CI" },

  # fallback
  { message = ".*", group = "Other" }
]
